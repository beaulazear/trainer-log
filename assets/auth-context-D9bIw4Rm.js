import{a as c,p as b}from"./chunk-UIGDSWPH-C3gEZbLY.js";const i="auth_token",f="https://dog-walking-app.onrender.com";async function e(t,o={}){const{timeout:r=8e3,...d}=o,n=new AbortController,h=setTimeout(()=>n.abort(),r),l=localStorage.getItem(i);try{const s=await fetch(`${f}${t}`,{...d,signal:n.signal,headers:{"Content-Type":"application/json",...l&&{Authorization:`Bearer ${l}`},...d.headers}});if(clearTimeout(h),!s.ok){const u=await s.json().catch(()=>({}));throw new Error(u.errors?.join(", ")||u.error||"API request failed")}return await s.json()}catch(s){throw s instanceof Error?s.name==="AbortError"?new Error("Request timeout"):s:new Error("Unknown error occurred")}}const w={getAll:()=>e("/training_sessions"),getSummary:()=>e("/training_sessions/summary"),getThisWeek:()=>e("/training_sessions/this_week"),getThisMonth:()=>e("/training_sessions/this_month"),create:t=>e("/training_sessions",{method:"POST",body:JSON.stringify({training_session:t})}),update:(t,o)=>e(`/training_sessions/${t}`,{method:"PATCH",body:JSON.stringify({training_session:o})}),delete:t=>e(`/training_sessions/${t}`,{method:"DELETE"}),exportCSV:async()=>{const t=localStorage.getItem(i),o=await fetch(`${f}/training_sessions/export`,{headers:{...t&&{Authorization:`Bearer ${t}`}}});if(!o.ok)throw new Error("Export failed");return await o.blob()},syncFromInvoices:()=>e("/training_sessions/sync_from_invoices",{method:"POST"})},P={get:()=>e("/certification_goal"),create:t=>e("/certification_goal",{method:"POST",body:JSON.stringify({certification_goal:t})}),update:t=>e("/certification_goal",{method:"PATCH",body:JSON.stringify({certification_goal:t})})},T={getAll:()=>e("/milestones"),markCelebrated:t=>e(`/milestones/${t}/mark_celebrated`,{method:"PATCH"})},E={get:()=>e("/training/dashboard")},k={get:()=>e("/training/stats")},I={getAll:()=>e("/pets"),create:t=>e("/pets",{method:"POST",body:JSON.stringify({pet:t})}),update:(t,o)=>e(`/pets/${t}`,{method:"PATCH",body:JSON.stringify(o)}),delete:t=>e(`/pets/${t}`,{method:"DELETE"}),updateActiveStatus:(t,o)=>e(`/pets/${t}/active`,{method:"PATCH",body:JSON.stringify({active:o})})},O={getDefaults:()=>e("/books"),getMyList:()=>e("/books/my_list"),addToList:t=>e(`/books/${t}/add_to_list`,{method:"POST"}),createCustom:t=>e("/books/custom",{method:"POST",body:JSON.stringify(t)}),update:(t,o)=>e(`/books/${t}`,{method:"PATCH",body:JSON.stringify(o)}),delete:t=>e(`/books/${t}`,{method:"DELETE"})},m={login:(t,o)=>e("/login",{method:"POST",body:JSON.stringify({username:t,password:o})}),logout:()=>e("/logout",{method:"DELETE"})},y=c.createContext(void 0);function C({children:t}){const[o,r]=c.useState(!1),[d,n]=c.useState(!0),[h,l]=c.useState(null);c.useEffect(()=>{s()},[]);const s=async()=>{try{if(!localStorage.getItem(i)){r(!1),n(!1);return}await E.get(),r(!0)}catch{localStorage.removeItem(i),r(!1)}finally{n(!1)}},u=async(g,p)=>{try{l(null),n(!0);const a=await m.login(g,p);a.token&&(localStorage.setItem(i,a.token),r(!0))}catch(a){throw l(a instanceof Error?a.message:"Login failed"),a}finally{n(!1)}},A=async()=>{try{await m.logout()}catch(g){console.error("Logout error:",g)}finally{localStorage.removeItem(i),r(!1)}},S=()=>localStorage.getItem(i);return b.jsx(y.Provider,{value:{isAuthenticated:o,isLoading:d,login:u,logout:A,error:h,getToken:S},children:t})}function $(){const t=c.useContext(y);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}export{C as A,O as b,P as c,E as d,T as m,I as p,k as s,w as t,$ as u};
